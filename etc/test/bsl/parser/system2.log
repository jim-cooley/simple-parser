

test:
"# sample rules file for pyser / qtradr
{ close }:(threshold=5) | signal

rules >> report | print



periods = {
    'train': (today-2y)..today
}
sma_periods1 = [3,5,10..20,28]
sma_periods2 = [5,10,12,20,30,60,90]

var r = range(sma_periods1)
var r2 = range(sma_periods2)

(open, high, low, close, adj_close) = yahoo( file='spq500.csv', 2y )
atr = (high + low) / 2
median_price = (open + close) / 2
price10a = price.delay(1d)[10:00]

report := { trades | select('symbol', 'buy_date', 'buy_price', 'sell_date', 'sell_price') }

rules: {
    baseline = {
        any:{ close >| sma(10), close >| sma(20), sma(10) >| sma(20) }:(threshold=0.01) | signal >> delay(1d) | atr => buy,
        close <| sma(10) | signal >> delay(1d) | atr -> sell
    },
    scenario1 = {
        { close >| sma(r2) } | signal >> atr.delay(1d) => buy,
        close <| sma(r1) | signal >> atr.delay(1d) => sell
    },
    scenario2 = {
        { close >| sma(r1) }:(threshold=0.01) | signal >> atr.delay(1d) => buy,
        close <| sma(r1) | signal >> atr.delay(1d) => sell
    },
    scenario3 = {
        { sma(r1) >| sma(r2) } | signal >> atr.delay(1d) => buy,
        close <| sma(r1) | signal >> atr.delay(1d) => sell
    },
    {
        { close >| sma(r1) } | signal >> atr.delay(1d) => buy,
        close <| sma(r2) | signal >> atr.delay(1d) => sell
    }
}

backtest( rules, period=period['train'])
rules >> report | print
"

tree1:  { close }:(threshold=5) | signal
result: list([Define(), ApplyChainProd()])

tree2:  rules >> report | print
result: list([Flow(), ApplyChainProd()])

tree3:  periods = {
result: Lit(None)

tree4:  sma_periods1 = [3,5,10..20,28]
result: Lit(None)

tree5:  sma_periods2 = [5,10,12,20,30,60,90]
result: Lit(None)

tree6:  var r = range(sma_periods1)
result: Lit(None)

tree7:  var r2 = range(sma_periods2)
result: Lit(None)

tree8:  (open, high, low, close, adj_close) = yahoo( file='spq500.csv', 2y )
result: Lit(None)

tree9:  atr = (high + low) / 2
result: Lit(None)

tree10:  median_price = (open + close) / 2
result: Lit(None)

tree11:  price10a = price.delay(1d)[10:00]
result: Lit(None)

tree12:  price10a = price.delay(1d)[10:00]
result: list([Time()])

tree13:  report := { trades | select('symbol', 'buy_date', 'buy_price', 'sell_date', 'sell_price') }
result: Lit(None)

tree14:  rules: {
result: Lit(None)

tree15:  backtest( rules, period=period['train'])
result: Lit(None)

tree16:  rules >> report | print
result: list([Flow(), ApplyChainProd()])
