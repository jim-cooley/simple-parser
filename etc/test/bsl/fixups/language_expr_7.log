

test: 7:
(close.sma(20) and close.sma(50)) | diff | sign | signal(how='cross')

tree1:  (close.sma(20) and close.sma(50)) | diff | sign | signal(how='cross')
    1  : Flow{TK.CHAIN, '|' len=4}
    2  :     BinOp(TK.AND, 'and')
    3  :         PropRef(TK.REF: close . FnCall(TK.FUNCTION, 'sma'))
    4  :             Get(TK.IDENT, 'close')
    5  :             FnCall('sma')
    6  :                 Get(TK.IDENT, 'sma')
    7  :                 List(TK.LIST, [Int()])
    8  :                     Int(TK.INT, 20)
    9  :         PropRef(TK.REF: close . FnCall(TK.FUNCTION, 'sma'))
   10  :             Get(TK.IDENT, 'close')
   11  :             FnCall('sma')
   12  :                 Get(TK.IDENT, 'sma')
   13  :                 List(TK.LIST, [Int()])
   14  :                     Int(TK.INT, 50)
   15  :     Ref(TK.IDENT, 'diff')
   16  :     Ref(TK.IDENT, 'sign')
   17  :     FnCall('signal')
   18  :         Ref(TK.IDENT, 'signal')
   19  :         List(TK.LIST, [Define()])
   20  :             Define(TK.DEFINE: how = cross)
   21  :                 Ref(TK.IDENT, 'how')
   22  :                 Str(TK.STR, 'cross')

tree1:(post)  (close.sma(20) and close.sma(50)) | diff | sign | signal(how='cross')
result: list([BinOp(), Ref(), Ref(), FnCall()])
    1  : Flow{TK.CHAIN, '|' len=4}
    2  :     BinOp(TK.AND, 'and')
    3  :         PropRef(TK.REF: close . FnCall(TK.FUNCTION, 'sma'))
    4  :             Get(TK.IDENT, 'close')
    5  :             FnCall('sma')
    6  :                 Get(TK.IDENT, 'sma')
    7  :                 List(TK.LIST, [Int()])
    8  :                     Int(TK.INT, 20)
    9  :         PropRef(TK.REF: close . FnCall(TK.FUNCTION, 'sma'))
   10  :             Get(TK.IDENT, 'close')
   11  :             FnCall('sma')
   12  :                 Get(TK.IDENT, 'sma')
   13  :                 List(TK.LIST, [Int()])
   14  :                     Int(TK.INT, 50)
   15  :     Ref(TK.IDENT, 'diff')
   16  :     Ref(TK.IDENT, 'sign')
   17  :     FnCall('signal')
   18  :         Ref(TK.IDENT, 'signal')
   19  :         List(TK.LIST, [Define()])
   20  :             Define(TK.DEFINE: how = cross)
   21  :                 Ref(TK.IDENT, 'how')
   22  :                 Str(TK.STR, 'cross')
